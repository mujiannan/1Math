* 前言
本文旨在优化无商业证书场景下的VSTO分发方案，目标是实现用户端的简单安装、自动更新。
* 项目介绍
我花费几个月时间断断续续折腾出了一个 Excel VSTO（开源），在分发阶段遇到了诸多问题。虽然麻烦不断，但通过不断努力（地搜索），最终得到了一套比较完善的方案，遂撰文分享一二。
对于非商业项目，我没有任何兼容性顾虑，项目中的.net Framework和Interop.Excel都选择了最新版本，因此可能会不兼容许多低版本系统或office。但是，不用担心，事实上，即便顾及到兼容性，我的分发思路也应该是通用的。
* Excel VSTO部署简介
你如果直接在Visual Studio中点击“发布”，会得到如下结构的文件（微软官方的图）。

这种发布方式被称为“ClickOnce”：
Deploy an Office solution by using ClickOnce - Visual Studio​docs.microsoft.com

如果不与如今的各种应用商店对比，这种发布方式看来还是非常优秀的。你可以指定用户从你的网站下载setup.exe，打开后安装器会自动从你设定的网络路径拉取所需文件，安装完成之后它能够保持自动更新……这一切看起来相当完美，前提是你得有一个已经获取系统授信的代码证书。
如果你没有商业证书，而是使用自己的测试证书之类的进行ClickOnce发布，并妄图将安装源设定在你的网站，甚至还妄想它能够保持自动更新……那么，你会得到这个：

截图来自网络
# 网络上的方案
为了兼顾简易安装与自动更新，我翻阅了网络上的各种Q&A，答案主要分为两派：“自制证书派”和“改注册表派”（以下分别简称“证书派”与“注册表派”）。
证书派：自制代码证书，让用户导入你的证书，参见通商软件
注册表派：注入注册表，修改用户机器的信任提示设置，参见微软官方文档
导入自制证书需要让用户多出一步操作，注入注册表也需要让用户在安装VSTO之前运行一个事先写好的脚本。
# 我的分发方案
我的思路非常简单：
## 自制证书，签名VSTO后按正常商业证书签署的VSTO那样发布到自己的站点上
## 自行制作一个Installer.exe，它应该是一个单文件软件，其作用主要有以下三点：
### 尝试下载自制证书，并导入用户机器
### 若证书导入失败，则尝试写入注册表
### 下载VSTO安装文件，运行
